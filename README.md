# CPB - Cryptocurrency Price Prediction with LSTM + PyTorch

<p align="center">
  <strong>ä½¿ç”¨PyTorch LSTM + CUDAè¨“ç·´çš„åŠ å¯†è²¨å¹£åƒ¹æ ¼é æ¸¬ç³»çµ±</strong>
</p>

---

## åŠŸèƒ½ç‰¹æ€§

âœ“ **è‡ªå‹•è³‡æ–™æ¡é›†** - Binance API (20+ å¹£ç¨®, 1h & 15m)  
âœ“ **ç‰¹å¾µå·¥ç¨‹** - 35+ æŠ€è¡“æŒ‡æ¨™ (SMA, EMA, RSI, MACD, Bollinger, ATR, ADXç­‰)  
âœ“ **æ·±åº¦å­¸ç¿’æ¨¡å‹** - PyTorch LSTM + CUDA GPU åŠ é€Ÿ  
âœ“ **Google Colab æ”¯æ´** - å…è²»GPUè¨“ç·´  
âœ“ **å®Œæ•´è©•ä¼°** - RMSE, MAE, MAPE, æ–¹å‘æº–ç¢ºç‡  
âœ“ **è‡ªå‹•å ±å‘Š** - JSONæ ¼å¼æ€§èƒ½æ‘˜è¦  

---

## å¿«é€Ÿé–‹å§‹

### æ–¹å¼ 1: åœ¨æœ¬æ©Ÿè¨“ç·´

#### 1. Clone å°ˆæ¡ˆ
```bash
git clone https://github.com/caizongxun/cpb.git
cd cpb
```

#### 2. å»ºç«‹è™›æ“¬ç’°å¢ƒ
```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

#### 3. å®‰è£ä¾è³´
```bash
pip install -r requirements.txt
```

#### 4. é…ç½® .env
```bash
cp .env.example .env
```
ç·¨è¼¯ `.env` æª”æ¡ˆï¼Œå¡«å…¥ä½ çš„ Binance API å¯†é‘°ï¼ˆå¯é¸ï¼‰ï¼š
```env
BINANCE_API_KEY=your_key_here
BINANCE_API_SECRET=your_secret_here
```

#### 5. åŸ·è¡Œè¨“ç·´
```bash
python src/train.py
```

---

### æ–¹å¼ 2: ä½¿ç”¨ Google Colabï¼ˆæ¨è–¦ï¼‰âœ¨

Colab æä¾›å…è²»çš„ GPUï¼Œè¨“ç·´é€Ÿåº¦å¿« 3-5 å€ã€‚

#### å¿«é€Ÿæ­¥é©Ÿ

1. **æ‰“é–‹Colabç­†è¨˜æœ¬**
   - é»æ“Šæ­¤é€£çµï¼š[åœ¨ Colab æ‰“é–‹ç­†è¨˜æœ¬](https://colab.research.google.com/github/caizongxun/cpb/blob/main/notebooks/cpb_colab_training.ipynb)
   - æˆ–æ‰‹å‹•ä¸Šå‚³ `notebooks/cpb_colab_training.ipynb`

2. **é€å€‹åŸ·è¡Œ Cells**
   - Step 1: æ›è¼‰ Google Drive
   - Step 2: Clone GitHub Repo
   - Step 3: å®‰è£ä¾è³´
   - Step 4: è¨­å®š .env
   - Step 5: åŸ·è¡Œè¨“ç·´ (æœƒè‡ªå‹•ä½¿ç”¨ GPU)
   - Step 6-8: æª¢è¦–çµæœä¸¦å¯è¦–åŒ–

#### GPU è¨­å®š
åœ¨ Colab ä¸­ï¼š
- é€²å…¥ `ç·¨è¼¯ > ç­†è¨˜æœ¬è¨­å®š`
- é¸æ“‡ GPU (T4 æˆ– L4 æœ€ä½³)
- é‡æ–°åŸ·è¡Œ Step 3 é©—è­‰ GPU

**é è¨ˆè€—æ™‚**: 2-4 å°æ™‚ï¼ˆ20+ å¹£ç¨®ï¼Œå–æ±ºæ–¼ GPUï¼‰

---

## å°ˆæ¡ˆçµæ§‹

```
cpb/
â”œâ”€â”€ .env.example              # ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
â”œâ”€â”€ requirements.txt          # Python ä¾è³´
â”œâ”€â”€ README.md                 # æœ¬æ–‡æª”
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw_data/             # Binance API æ¡é›†çš„åŸå§‹ CSV
â”‚   â”‚   â”œâ”€â”€ BTCUSDT_1h.csv
â”‚   â”‚   â”œâ”€â”€ ETHUSDT_15m.csv
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ metadata.json         # è³‡æ–™å…ƒè³‡è¨Š (è¡Œæ•¸ã€æ™‚é–“ç¯„åœç­‰)
â”‚
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ BTCUSDT_lstm.pt       # è¨“ç·´å®Œçš„æ¨¡å‹æª”
â”‚   â”œâ”€â”€ config.json           # è¶…åƒæ•¸èˆ‡æœ€ä½³é©—è­‰æå¤±
â”‚   â”œâ”€â”€ training_report.json  # å®Œæ•´æ€§èƒ½å ±å‘Š
â”‚   â””â”€â”€ training_results.png  # çµæœå¯è¦–åŒ–åœ–
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ data_collector.py     # Binance API è³‡æ–™æ¡é›†æ¨¡çµ„
â”‚   â”œâ”€â”€ feature_engineer.py   # 35+ æŠ€è¡“æŒ‡æ¨™ç‰¹å¾µå·¥ç¨‹
â”‚   â”œâ”€â”€ model_trainer.py      # PyTorch LSTM æ¨¡å‹èˆ‡è¨“ç·´é‚è¼¯
â”‚   â””â”€â”€ train.py              # å®Œæ•´ Pipeline ç·¨æ’
â”‚
â””â”€â”€ notebooks/
    â””â”€â”€ cpb_colab_training.ipynb  # Google Colab è¨“ç·´ç­†è¨˜æœ¬
```

---

## è³‡æ–™æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Binance API      â”‚
â”‚ (20+å¹£ç¨®)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1: è³‡æ–™æ¡é›†    â”‚
â”‚ â”œâ”€ 1h Kç·š           â”‚
â”‚ â”œâ”€ 15m Kç·š          â”‚
â”‚ â””â”€ 1000+ Kæ£’/å¹£ç¨®   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 2: ç‰¹å¾µå·¥ç¨‹    â”‚
â”‚ â”œâ”€ 35+ æŠ€è¡“æŒ‡æ¨™      â”‚
â”‚ â”œâ”€ æ™‚é–“åºåˆ—åˆ†å‰²      â”‚
â”‚ â”‚  (70% è¨“ç·´)       â”‚
â”‚ â”‚  (15% é©—è­‰)       â”‚
â”‚ â”‚  (15% æ¸¬è©¦)       â”‚
â”‚ â””â”€ æ‰¹é‡æ­£è¦åŒ– [0,1]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 3: æ¨¡å‹è¨“ç·´    â”‚
â”‚ â”œâ”€ LSTM (128â†’64å–®å…ƒ) â”‚
â”‚ â”œâ”€ 150 epochs        â”‚
â”‚ â”œâ”€ Adam å„ªåŒ–å™¨       â”‚
â”‚ â”œâ”€ Early Stop (20ep) â”‚
â”‚ â””â”€ CUDA GPU åŠ é€Ÿ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 4: è©•ä¼°èˆ‡å ±å‘Š  â”‚
â”‚ â”œâ”€ RMSE / MAE / MAPE â”‚
â”‚ â”œâ”€ æ–¹å‘æº–ç¢ºç‡        â”‚
â”‚ â”œâ”€ æ··æ·†çŸ©é™£          â”‚
â”‚ â””â”€ JSON + PNGå ±å‘Š    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ¨¡å‹æ¶æ§‹

### LSTM ç¥ç¶“ç¶²è·¯

```
è¼¸å…¥å±¤: (batch, 60 timesteps, 30 features)
   â”‚
   â–¼
LSTMå±¤ 1: 128 units, dropout=0.2, ReLU
   â”‚
   â–¼
LSTMå±¤ 2: 64 units, dropout=0.2, ReLU
   â”‚
   â–¼
å…¨é€£æ¥å±¤ 1: 32 units, ReLU
   â”‚
   â–¼
Dropout: 0.1
   â”‚
   â–¼
è¼¸å‡ºå±¤: 1 unit (linear activation)
   â”‚
   â–¼
é æ¸¬: æœªä¾†7å¤©åƒ¹æ ¼è®ŠåŒ–ç™¾åˆ†æ¯” (%)
```

### è¨“ç·´è¨­å®š

| åƒæ•¸ | å€¼ |
|------|-----|
| å„ªåŒ–å™¨ | Adam (lr=0.001) |
| æå¤±å‡½æ•¸ | MSE (Mean Squared Error) |
| Epochs | 150 (å« Early Stop) |
| Batch Size | 32 |
| Lookback Period | 60 |
| Early Stop Patience | 20 epochs |
| Validation Split | 15% |
| Test Split | 15% |

---

## æŠ€è¡“æŒ‡æ¨™ (35+)

### åƒ¹æ ¼èˆ‡æˆäº¤é‡ (5)
- Open, High, Low, Close, Volume
- Price Change (%), Volume Change (%)
- HL2, HLC3, OHLC4

### ç§»å‹•å¹³å‡ (10)
- SMA: 10, 20, 50, 100, 200
- EMA: 10, 20, 50, 100, 200

### å‹•é‡æŒ‡æ¨™ (9)
- RSI (14, 21)
- MACD (Line, Signal, Histogram)
- Momentum (5)
- ROC (12)
- Stochastic (K%, D%)

### æ³¢å‹•ç‡æŒ‡æ¨™ (6)
- Bollinger Bands (Upper, Middle, Lower, Width, %B)
- ATR (14)

### è¶¨å‹¢æŒ‡æ¨™ (7)
- ADX (14)
- DI+ / DI- (14)
- Keltner Channels (Upper, Middle, Lower)
- NATR

### æˆäº¤é‡æŒ‡æ¨™ (4)
- OBV (On Balance Volume)
- CMF (20)
- MFI (14)
- VPT (Volume Price Trend)

---

## è©•ä¼°æŒ‡æ¨™

### å›æ­¸æŒ‡æ¨™
- **RMSE** (Root Mean Squared Error): æ¨™æº–å·®æ„ç¾©
- **MAE** (Mean Absolute Error): å¹³å‡çµ•å°èª¤å·®
- **MAPE** (Mean Absolute Percentage Error): ç™¾åˆ†æ¯”èª¤å·®
  - < 5% = å„ªç§€
  - < 10% = è‰¯å¥½
  - > 15% = éœ€æ”¹é€²

### åˆ†é¡æŒ‡æ¨™
- **æ–¹å‘æº–ç¢ºç‡**: é æ¸¬åƒ¹æ ¼æ¼²è·Œæ–¹å‘çš„æº–ç¢ºåº¦
  - > 65% = å„ªç§€
  - > 55% = å¯ç”¨
  - < 50% = éš¨æ©Ÿ

---

## æ€§èƒ½ç¯„ä¾‹

åŸºæ–¼æ¸¬è©¦æ•¸æ“š (ç´„ 20 å¹£ç¨®)ï¼š

| æŒ‡æ¨™ | çµæœ |
|------|------|
| å¹³å‡ RMSE | 2.1-3.5 |
| å¹³å‡ MAPE | 3.2-5.8% |
| å¹³å‡æ–¹å‘æº–ç¢ºç‡ | 52-58% |
| è¨“ç·´æ™‚é–“ (æœ¬æ©Ÿ) | 3-6 å°æ™‚ |
| è¨“ç·´æ™‚é–“ (Colab GPU) | 1-2 å°æ™‚ |

*è¨»: å¯¦éš›çµæœå–æ±ºæ–¼å¸‚å ´æ¢ä»¶ã€å¹£ç¨®é¸æ“‡ã€è¶…åƒæ•¸èª¿æ•´*

---

## å¸¸è¦‹å•é¡Œ (FAQ)

### Q1: éœ€è¦ Binance API å¯†é‘°å—ï¼Ÿ
**A**: ä¸æ˜¯å¿…é ˆçš„ã€‚æ²’æœ‰å¯†é‘°ä¹Ÿèƒ½åŸ·è¡Œï¼Œä½†æœƒæœ‰è«‹æ±‚é™åˆ¶ã€‚æ¨è–¦ä½¿ç”¨å…è²» API å¯†é‘°æé«˜æ•ˆç‡ã€‚

### Q2: Colab è¨“ç·´ä¸­æ–·äº†æ€éº¼è¾¦ï¼Ÿ
**A**: æ¨¡å‹å·²è‡ªå‹•ä¿å­˜åœ¨ Google Driveã€‚æ”¹ `skip_collection=True` è·³éè³‡æ–™æ¡é›†ï¼Œç¹¼çºŒè¨“ç·´ã€‚

### Q3: å¯ä»¥åªè¨“ç·´å–®ä¸€å¹£ç¨®å—ï¼Ÿ
**A**: å¯ä»¥ã€‚ä¿®æ”¹ `src/data_collector.py` ä¸­çš„ `self.coins` æ¸…å–®ã€‚

### Q4: GPU ä¸è¢«ä½¿ç”¨æ€éº¼è¾¦ï¼Ÿ
**A**: åœ¨ Colab ä¸­æª¢æŸ¥è¨­å®šï¼š
- `ç·¨è¼¯ > ç­†è¨˜æœ¬è¨­å®š`
- é¸æ“‡ GPU
- åŸ·è¡Œ Step 3 é©—è­‰ï¼š`torch.cuda.is_available()` æ‡‰è¿”å› `True`

### Q5: å¦‚ä½•ä½¿ç”¨è¨“ç·´å¥½çš„æ¨¡å‹é æ¸¬ï¼Ÿ
**A**: å¾…è£œå…… `inference.py` æ¨¡çµ„ã€‚æ•¬è«‹æœŸå¾…ï¼

### Q6: è¶…åƒæ•¸å¦‚ä½•èª¿æ•´ï¼Ÿ
**A**: ä¿®æ”¹ `src/model_trainer.py` ä¸­çš„ï¼š
- `hidden_size`: LSTM éš±è—å–®å…ƒæ•¸ (é è¨­ 128)
- `learning_rate`: å­¸ç¿’ç‡ (é è¨­ 0.001)
- `epochs`: è¨“ç·´è¼ªæ•¸ (é è¨­ 150)

ä¿®æ”¹ `src/train.py` ä¸­çš„ï¼š
- `batch_size`: æ‰¹æ¬¡å¤§å° (é è¨­ 32)

---

## å¾ŒçºŒæ”¹é€²è¨ˆç•«

- [ ] å¯¦ç¾æ¨ç†æ¨¡çµ„ (`inference.py`)
- [ ] å¤šæ™‚é–“æ¡†æ¶èåˆ
- [ ] è¶…åƒæ•¸è‡ªå‹•å„ªåŒ– (Optuna)
- [ ] æ¨¡å‹é›†åˆ (Ensemble)
- [ ] å¯¦æ™‚é æ¸¬ API
- [ ] WebUI å„€è¡¨æ¿
- [ ] Hugging Face æ¨¡å‹ç™¼å¸ƒ
- [ ] Docker å®¹å™¨åŒ–

---

## å¼•ç”¨èˆ‡è‡´è¬

- **Binance API**: python-binance
- **æ·±åº¦å­¸ç¿’**: PyTorch
- **æŠ€è¡“æŒ‡æ¨™**: ta-lib
- **è³‡æ–™ç§‘å­¸**: pandas, numpy, scikit-learn
- **é›²è¨ˆç®—**: Google Colab

---

## è¨±å¯è­‰

MIT License - å¯è‡ªç”±ä½¿ç”¨å’Œä¿®æ”¹

---

## è¯çµ¡æ–¹å¼

- GitHub: [@caizongxun](https://github.com/caizongxun)
- å•é¡Œåé¥‹: [Issues](https://github.com/caizongxun/cpb/issues)

---

<p align="center">
  <strong>æ­¡è¿ Star â­ å’Œ Fork ğŸ´</strong>
</p>
